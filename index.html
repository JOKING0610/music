<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JokingMusic</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }

        :root {
            --primary: #00f2fe;
            --primary-dark: #00c6ff;
            --secondary: #4facfe;
            --accent: #a8ff78;
            --bg-color: #0a0e17;
            --card-bg: rgba(16, 23, 36, 0.8);
            --card-bg-solid: #101724;
            --text-primary: #ffffff;
            --text-secondary: #a0aec0;
            --border: rgba(255, 255, 255, 0.1);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            --glow: 0 0 15px rgba(0, 242, 254, 0.5);
        }

        body {
            background: linear-gradient(135deg, #0a0e17 0%, #0f1a2e 100%);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            overflow-x: hidden;
        }

        /* 侧边栏样式 */
        .sidebar {
            width: 240px;
            background: var(--card-bg-solid);
            border-right: 1px solid var(--border);
            padding: 20px 0;
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
            height: 100vh;
            position: sticky;
            top: 0;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 0 20px 20px;
            border-bottom: 1px solid var(--border);
            margin-bottom: 20px;
        }

        .sidebar-title {
            font-size: 1.3rem;
            font-weight: 700;
            background: linear-gradient(to right, var(--primary), var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-align: center;
        }

        .sidebar-menu {
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding: 0 10px;
        }

        .sidebar-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3 ease;
            color: var(--text-secondary);
        }

        .sidebar-item:hover {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
        }

        .sidebar-item.active {
            background: rgba(0, 242, 254, 0.1);
            color: var(--primary);
            box-shadow: var(--glow);
        }

        .sidebar-item i {
            font-size: 1.2rem;
            width: 24px;
            text-align: center;
        }

        .sidebar-footer {
            margin-top: auto;
            padding: 20px;
            border-top: 1px solid var(--border);
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.8rem;
        }

        /* 主内容区域 */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
            flex: 1;
        }

        .search-section {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            border: 1px solid var(--border);
            backdrop-filter: blur(10px);
            width: 100%;
        }

        .search-form {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            align-items: end;
            width: 100%;
        }

        .form-group {
            flex: 1;
            min-width: 300px;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--text-primary);
            text-transform: uppercase;
            font-size: 0.9rem;
            letter-spacing: 1px;
        }

        .form-control {
            width: 100%;
            padding: 15px 20px;
            border: 1px solid var(--border);
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3 ease;
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: var(--glow);
        }

        .btn {
            padding: 15px 30px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: #0a0e17;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3 ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: var(--glow);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .results-section {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            border: 1px solid var(--border);
            backdrop-filter: blur(10px);
            width: 100%;
        }

        .section-title {
            font-size: 1.8rem;
            margin-bottom: 25px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .section-title i {
            color: var(--primary);
            font-size: 1.5rem;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 25px;
            width: 100%;
        }

        .song-card {
            background: var(--card-bg-solid);
            border-radius: 15px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 20px;
            transition: all 0.3 ease;
            cursor: pointer;
            border: 1px solid var(--border);
            position: relative;
            overflow: hidden;
        }

        .song-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 242, 254, 0.1), transparent);
            transition: left 0.5;
        }

        .song-card:hover::before {
            left: 100%;
        }

        .song-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow);
            border-color: var(--primary);
        }

        .song-cover {
            width: 70px;
            height: 70px;
            border-radius: 10px;
            object-fit: cover;
            flex-shrink: 0;
            background: linear-gradient(135deg, #2c3e50, #4a5568);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            font-size: 1.2rem;
            position: relative;
            overflow: hidden;
        }

        .song-cover .play-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3 ease;
            color: var(--primary);
            font-size: 1.5rem;
        }

        .song-card:hover .play-overlay {
            opacity: 1;
        }

        .song-info {
            flex: 1;
            overflow: hidden;
        }

        .song-title {
            font-weight: 700;
            font-size: 1.2rem;
            margin-bottom: 8px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .song-artist, .song-album {
            color: var(--text-secondary);
            font-size: 0.95rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .song-actions {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3 ease;
        }

        .action-btn:hover {
            background: rgba(0, 242, 254, 0.1);
            color: var(--primary);
            border-color: var(--primary);
            box-shadow: var(--glow);
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-top: 30px;
            width: 100%;
        }

        .pagination-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3 ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .pagination-btn:hover:not(:disabled) {
            background: rgba(0, 242, 254, 0.1);
            color: var(--primary);
            border-color: var(--primary);
            box-shadow: var(--glow);
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination-info {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 30px;
            color: var(--text-secondary);
            width: 100%;
        }

        .loading i {
            margin-right: 15px;
            animation: spin 1 linear infinite;
            color: var(--primary);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 50px 20px;
            color: var(--text-secondary);
            width: 100%;
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 20px;
            color: var(--border);
        }

        footer {
            text-align: center;
            padding: 30px;
            color: var(--text-secondary);
            font-size: 1rem;
            margin-top: auto;
            border-top: 1px solid var(--border);
            width: 100%;
        }

        /* 播放器样式 - 缩小版 */
        .player-section {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 15px;
            box-shadow: var(--shadow);
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 280px;
            z-index: 1000;
            transition: all 0.3 ease;
            border: 1px solid var(--border);
            backdrop-filter: blur(10px);
        }

        .player-section .now-playing {
            cursor: pointer;
            transition: all 0.3 ease;
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .player-section .now-playing:hover {
            transform: translateY(-2px);
        }

        .current-cover {
            width: 45px;
            height: 45px;
            border-radius: 8px;
            object-fit: cover;
            flex-shrink: 0;
            background: linear-gradient(135deg, #2c3e50, #4a5568);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            font-size: 0.9rem;
            position: relative;
            overflow: hidden;
        }

        .current-info {
            flex: 1;
            overflow: hidden;
            min-width: 0;
        }

        .current-title {
            font-size: 0.95rem;
            font-weight: 700;
            margin-bottom: 3px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .current-artist {
            color: var(--text-secondary);
            font-size: 0.8rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .player-controls {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .progress-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .time-display {
            font-size: 0.7rem;
            color: var(--text-secondary);
            min-width: 30px;
        }

        .progress-bar {
            flex: 1;
            height: 3px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            position: relative;
            cursor: pointer;
        }

        .progress {
            height: 100%;
            background: linear-gradient(to right, var(--primary), var(--accent));
            border-radius: 2px;
            width: 0%;
            position: relative;
        }

        .progress::after {
            content: '';
            position: absolute;
            top: -2px;
            right: 0;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--accent);
            box-shadow: 0 0 3px var(--accent);
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .progress-bar:hover .progress::after,
        .progress-bar.dragging .progress::after {
            opacity: 1;
        }

        .control-buttons {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 12px;
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            color: var(--text-primary);
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            border-radius: 50%;
        }

        .control-btn:hover {
            background: rgba(0, 242, 254, 0.1);
            color: var(--primary);
            border-color: var(--primary);
            box-shadow: var(--glow);
        }

        .play-btn {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--bg-color);
            font-size: 1rem;
            border: none;
        }

        .play-btn:hover {
            transform: scale(1.05);
            box-shadow: var(--glow);
        }

        .volume-container {
            position: relative;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .volume-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            color: var(--text-primary);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .volume-btn:hover {
            background: rgba(0, 242, 254, 0.1);
            color: var(--primary);
            border-color: var(--primary);
            box-shadow: var(--glow);
        }

        .volume-panel {
            position: absolute;
            bottom: 35px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--card-bg-solid);
            border-radius: 8px;
            padding: 12px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            z-index: 1001;
            width: 30px;
        }

        .volume-panel.show {
            display: flex;
        }

        .volume-slider {
            width: 3px;
            height: 80px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            position: relative;
            cursor: pointer;
        }

        .volume-level {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            background: linear-gradient(to top, var(--primary), var(--accent));
            border-radius: 2px;
            height: 70%;
        }

        .volume-handle {
            position: absolute;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--accent);
            box-shadow: 0 0 3px var(--accent);
            left: -2.5px;
            transform: translateY(50%);
            opacity: 0;
            transition: opacity 0.2s ease;
            z-index: 10;
        }

        .volume-slider:hover .volume-handle,
        .volume-slider.dragging .volume-handle {
            opacity: 1;
        }

        .play-mode-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            color: var(--text-primary);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.8rem;
        }

        .play-mode-btn:hover {
            background: rgba(0, 242, 254, 0.1);
            color: var(--primary);
            border-color: var(--primary);
            box-shadow: var(--glow);
        }

        /* 音质选择器样式 */
        .quality-selector {
            display: flex;
            align-items: center;
            gap: 8px;
            position: relative;
        }

        .quality-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.8rem;
        }

        .quality-btn:hover {
            background: rgba(0, 242, 254, 0.1);
            color: var(--primary);
            border-color: var(--primary);
            box-shadow: var(--glow);
        }

        .quality-panel {
            position: absolute;
            bottom: 35px;
            left: 0;
            background: var(--card-bg-solid);
            border-radius: 8px;
            padding: 12px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            display: none;
            flex-direction: column;
            gap: 6px;
            z-index: 1001;
            width: 130px;
        }

        .quality-panel.show {
            display: flex;
        }

        .quality-option {
            padding: 6px 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .quality-option:hover {
            background: rgba(0, 242, 254, 0.1);
            color: var(--primary);
        }

        .quality-option.active {
            background: rgba(0, 242, 254, 0.2);
            color: var(--primary);
            font-weight: 600;
        }

        /* 歌单面板 */
        .playlist-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--shadow);
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            z-index: 1002;
            border: 1px solid var(--border);
            backdrop-filter: blur(10px);
            display: none;
        }

        .playlist-panel.show {
            display: block;
        }

        .playlist-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .playlist-title {
            font-size: 1.8rem;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .close-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            color: var(--primary);
        }

        .playlist-items {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .playlist-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .playlist-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }

        .playlist-item-cover {
            width: 50px;
            height: 50px;
            border-radius: 8px;
            object-fit: cover;
            background: linear-gradient(135deg, #2c3e50, #4a5568);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            font-size: 1rem;
        }

        .playlist-item-info {
            flex: 1;
        }

        .playlist-item-title {
            font-weight: 600;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .playlist-item-artist {
            color: var(--text-secondary);
            font-size: 0.9rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .playlist-item-actions {
            display: flex;
            gap: 10px;
        }

        .playlist-remove-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .playlist-remove-btn:hover {
            background: rgba(232, 67, 60, 0.2);
            color: #e8433c;
            border-color: #e8433c;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1001;
            display: none;
        }

        .overlay.show {
            display: block;
        }

        /* 背景装饰元素 */
        .bg-elements {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }

        .bg-element {
            position: absolute;
            border-radius: 50%;
            background: rgba(0, 242, 254, 0.05);
            filter: blur(40px);
        }

        .bg-element:nth-child(1) {
            width: 300px;
            height: 300px;
            top: 10%;
            left: 10%;
            background: rgba(0, 242, 254, 0.1);
        }

        .bg-element:nth-child(2) {
            width: 200px;
            height: 200px;
            top: 60%;
            right: 10%;
            background: rgba(79, 172, 254, 0.1);
        }

        .bg-element:nth-child(3) {
            width: 150px;
            height: 150px;
            bottom: 20%;
            left: 20%;
            background: rgba(168, 255, 120, 0.1);
        }

        /* 全屏播放界面 - 优化版 */
        .player-fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0a0e17 0%, #0f1a2e 100%);
            z-index: 2000;
            display: none;
            flex-direction: column;
            color: var(--text-primary);
            overflow: hidden;
        }
        
        .player-fullscreen.show {
            display: flex;
        }
        
        .player-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 30px;
            border-bottom: 1px solid var(--border);
            flex-shrink: 0;
        }
        
        .player-title {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(to right, var(--primary), var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .close-player {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .close-player:hover {
            color: var(--primary);
            transform: scale(1.1);
        }
        
        .player-content {
            display: flex;
            flex: 1;
            padding: 20px;
            gap: 30px;
            overflow: hidden;
            max-height: calc(100vh - 180px);
        }
        
        /* 左侧封面区域 */
        .player-cover-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-width: 0;
            max-width: 30%;
        }
        
        .player-cover {
            width: 100%;
            max-width: 280px;
            aspect-ratio: 1;
            border-radius: 20px;
            object-fit: cover;
            background: linear-gradient(135deg, #2c3e50, #4a5568);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            font-size: 3rem;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }
        
        .player-song-info {
            text-align: center;
            width: 100%;
        }
        
        .player-song-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 8px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .player-song-artist {
            font-size: 1.1rem;
            color: var(--text-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        /* 右侧歌词区域 */
        .player-lyrics-section {
            flex: 2;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            min-width: 0;
            max-width: 70%;
        }
        
        .player-lyrics-container {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 15px;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            scroll-behavior: smooth;
        }
        
        .player-lyrics-content {
            text-align: center;
            width: 100%;
        }
        
        .player-lyric-line {
            padding: 12px 0;
            font-size: 1.2rem;
            line-height: 1.6;
            transition: all 0.3s ease;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0.6;
            white-space: normal;
            word-break: break-word;
        }
        
        .player-lyric-line.active {
            opacity: 1;
            color: var(--primary);
            font-weight: 700;
            font-size: 1.5rem;
            transform: scale(1.05);
            text-shadow: 0 0 10px rgba(0, 242, 254, 0.5);
        }
        
        .player-controls-section {
            padding: 15px 20px;
            border-top: 1px solid var(--border);
            background: var(--card-bg);
            flex-shrink: 0;
        }
        
        .player-progress-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .player-time-display {
            font-size: 0.8rem;
            color: var(--text-secondary);
            min-width: 40px;
        }
        
        .player-progress-bar {
            flex: 1;
            height: 5px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            position: relative;
            cursor: pointer;
        }
        
        .player-progress {
            height: 100%;
            background: linear-gradient(to right, var(--primary), var(--accent));
            border-radius: 3px;
            width: 0%;
            position: relative;
        }
        
        .player-progress::after {
            content: '';
            position: absolute;
            top: -3px;
            right: 0;
            width: 11px;
            height: 11px;
            border-radius: 50%;
            background: var(--accent);
            box-shadow: 0 0 5px var(--accent);
            opacity: 0;
            transition: opacity 0.2s ease;
        }
        
        .player-progress-bar:hover .player-progress::after {
            opacity: 1;
        }
        
        .player-control-buttons {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
        }
        
        .player-control-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            color: var(--text-primary);
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 45px;
            height: 45px;
            border-radius: 50%;
        }
        
        .player-control-btn:hover {
            background: rgba(0, 242, 254, 0.1);
            color: var(--primary);
            border-color: var(--primary);
            box-shadow: var(--glow);
        }
        
        .player-play-btn {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--bg-color);
            font-size: 1.3rem;
            border: none;
        }
        
        .player-play-btn:hover {
            transform: scale(1.05);
            box-shadow: var(--glow);
        }
        
        .player-volume-container {
            position: relative;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .player-volume-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            color: var(--text-primary);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .player-volume-btn:hover {
            background: rgba(0, 242, 254, 0.1);
            color: var(--primary);
            border-color: var(--primary);
            box-shadow: var(--glow);
        }
        
        .player-volume-panel {
            position: absolute;
            bottom: 45px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--card-bg-solid);
            border-radius: 10px;
            padding: 12px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            z-index: 2001;
            width: 35px;
        }
        
        .player-volume-panel.show {
            display: flex;
        }
        
        .player-volume-slider {
            width: 4px;
            height: 100px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            position: relative;
            cursor: pointer;
        }
        
        .player-volume-level {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            background: linear-gradient(to top, var(--primary), var(--accent));
            border-radius: 2px;
            height: 70%;
        }
        
        .player-volume-handle {
            position: absolute;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--accent);
            box-shadow: 0 0 5px var(--accent);
            left: -3px;
            transform: translateY(50%);
            opacity: 0;
            transition: opacity 0.2s ease;
            z-index: 10;
        }
        
        .player-volume-slider:hover .player-volume-handle {
            opacity: 1;
        }

        /* 响应式调整 */
        @media (max-width: 1024px) {
            .sidebar {
                width: 200px;
            }
            
            .player-section {
                width: 260px;
            }
        }

        @media (max-width: 768px) {
            body {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
                padding: 15px 0;
            }
            
            .sidebar-menu {
                flex-direction: row;
                justify-content: center;
                flex-wrap: wrap;
            }
            
            .sidebar-item {
                flex: 0 0 auto;
            }
            
            .main-content {
                height: auto;
            }
            
            .search-form {
                flex-direction: column;
            }
            
            .form-group {
                width: 100%;
            }
            
            .results-grid {
                grid-template-columns: 1fr;
            }
            
            .player-section {
                width: calc(100% - 40px);
                right: 20px;
                bottom: 20px;
            }
            
            .section-title {
                font-size: 1.5rem;
            }
            
            .playlist-panel {
                width: 95%;
                padding: 20px;
            }
            
            .player-content {
                flex-direction: column;
                padding: 15px;
                gap: 20px;
                max-height: calc(100vh - 160px);
            }
            
            .player-cover-section,
            .player-lyrics-section {
                max-width: 100%;
            }
            
            .player-cover {
                width: 200px;
                height: 200px;
                margin-bottom: 15px;
                font-size: 2.5rem;
            }
            
            .player-song-title {
                font-size: 1.3rem;
            }
            
            .player-song-artist {
                font-size: 1rem;
            }
            
            .player-lyric-line {
                font-size: 1.1rem;
                min-height: 45px;
            }
            
            .player-lyric-line.active {
                font-size: 1.3rem;
            }
            
            .player-control-buttons {
                gap: 15px;
            }
            
            .player-control-btn {
                width: 40px;
                height: 40px;
            }
            
            .player-play-btn {
                width: 50px;
                height: 50px;
            }
            
            .player-volume-btn {
                width: 35px;
                height: 35px;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }
            
            .search-section, .results-section {
                padding: 20px;
            }
            
            .player-section {
                width: calc(100% - 30px);
                right: 15px;
                bottom: 15px;
                padding: 15px;
            }
            
            .control-buttons {
                gap: 10px;
            }
            
            .control-btn {
                width: 28px;
                height: 28px;
            }
            
            .play-btn {
                width: 36px;
                height: 36px;
            }
            
            .player-header {
                padding: 15px 20px;
            }
            
            .player-content {
                padding: 10px;
                gap: 15px;
            }
            
            .player-cover {
                width: 180px;
                height: 180px;
            }
            
            .player-lyric-line {
                font-size: 1rem;
                min-height: 40px;
            }
            
            .player-lyric-line.active {
                font-size: 1.2rem;
            }
            
            .player-controls-section {
                padding: 10px 15px;
            }
        }

        /* 滚动条样式 */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(to bottom, var(--primary), var(--secondary));
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(to bottom, var(--primary-dark), var(--secondary));
        }

        /* 封面加载动画 */
        .cover-loading {
            animation: pulse 1.5 infinite;
        }

        @keyframes pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }
    </style>
</head>
<body>
    <!-- 背景装饰元素 -->
    <div class="bg-elements">
        <div class="bg-element"></div>
        <div class="bg-element"></div>
        <div class="bg-element"></div>
    </div>

    <!-- 侧边栏 -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h2 class="sidebar-title">JokingMusic</h2>
        </div>
        <div class="sidebar-menu">
            <div class="sidebar-item active" data-api="netease">
                <i class="fas fa-music"></i>
                <span>网易云音乐(VIP限制)</span>
            </div>
            <div class="sidebar-item" data-api="qq">
                <i class="fas fa-headphones"></i>
                <span>QQ音乐(暂不支持歌词显示)</span>
            </div>
        </div>
        <div class="sidebar-footer">
            <p>许多功能未完善，敬请期待</p>
            <p>基于云智API开发</p>
            <p>版本 0.0.1测试版</p>
        </div>
    </div>

    <!-- 全屏播放界面 -->
    <div class="player-fullscreen" id="playerFullscreen">
        <div class="player-header">
            <button class="close-player" id="closePlayer">
                <i class="fas fa-chevron-down"></i>
            </button>
            <h2 class="player-title">正在播放</h2>
            <div style="width: 40px;"></div> <!-- 占位保持平衡 -->
        </div>
        <div class="player-content">
            <div class="player-cover-section">
                <div id="playerCover" class="player-cover">
                    <i class="fas fa-music"></i>
                </div>
                <div class="player-song-info">
                    <div id="playerSongTitle" class="player-song-title">未选择歌曲</div>
                    <div id="playerSongArtist" class="player-song-artist">未知艺术家</div>
                </div>
            </div>
            <div class="player-lyrics-section">
                <div id="playerLyricsContainer" class="player-lyrics-container">
                    <div class="player-lyrics-content" id="playerLyricsContent">
                        <div class="empty-state">
                            <i class="fas fa-file-alt"></i>
                            <p>选择歌曲后显示歌词</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="player-controls-section">
            <div class="player-progress-container">
                <span id="playerCurrentTime" class="player-time-display">0:00</span>
                <div class="player-progress-bar" id="playerProgressBar">
                    <div class="player-progress" id="playerProgress"></div>
                </div>
                <span id="playerDuration" class="player-time-display">0:00</span>
            </div>
            <div class="player-control-buttons">
                <button class="player-control-btn" id="playerPrevBtn">
                    <i class="fas fa-step-backward"></i>
                </button>
                <button class="player-control-btn player-play-btn" id="playerPlayBtn">
                    <i class="fas fa-play"></i>
                </button>
                <button class="player-control-btn" id="playerNextBtn">
                    <i class="fas fa-step-forward"></i>
                </button>
                <button class="player-control-btn" id="playerPlayModeBtn" title="循环播放">
                    <i class="fas fa-repeat"></i>
                </button>
                <div class="player-volume-container">
                    <button class="player-volume-btn" id="playerVolumeBtn">
                        <i class="fas fa-volume-up"></i>
                    </button>
                    <div class="player-volume-panel" id="playerVolumePanel">
                        <div class="player-volume-slider" id="playerVolumeSlider">
                            <div class="player-volume-level" id="playerVolumeLevel"></div>
                            <div class="player-volume-handle" id="playerVolumeHandle"></div>
                        </div>
                    </div>
                </div>
                <div class="quality-selector" id="playerQualitySelector">
                    <button class="quality-btn" id="playerQualityBtn">
                        <i class="fas fa-music"></i>
                        <span id="playerQualityText">音质</span>
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="quality-panel" id="playerQualityPanel">
                        <div class="quality-option" data-quality="flac">FLAC (无损)</div>
                        <div class="quality-option" data-quality="640k">高品质 (640k)</div>
                        <div class="quality-option active" data-quality="192k">标准 (192k)</div>
                        <div class="quality-option" data-quality="96k">流畅 (96k)</div>
                        <div class="quality-option" data-quality="48k">低音质 (48k)</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 主内容区域 -->
    <div class="main-content">
        <div class="container">
            <section class="search-section">
                <!-- 网易云音乐搜索表单 -->
                <form class="search-form" id="neteaseSearchForm">
                    <div class="form-group">
                        <label for="songName">歌曲名称</label>
                        <input type="text" id="songName" class="form-control" placeholder="输入歌曲名称..." required>
                    </div>
                    
                    <button type="submit" class="btn">
                        <i class="fas fa-search"></i> 搜索歌曲
                    </button>
                </form>
                
                <!-- QQ音乐搜索表单 -->
                <form class="search-form" id="qqSearchForm" style="display: none;">
                    <div class="form-group">
                        <label for="qqSongName">歌曲名称</label>
                        <input type="text" id="qqSongName" class="form-control" placeholder="输入歌曲名称..." required>
                    </div>
                    
                    <button type="submit" class="btn">
                        <i class="fas fa-search"></i> 搜索歌曲
                    </button>
                </form>
            </section>
            
            <section class="results-section">
                <h2 class="section-title">
                    <i class="fas fa-music"></i> 搜索结果
                </h2>
                <div id="resultsContainer" class="results-grid">
                    <div class="empty-state">
                        <i class="fas fa-search"></i>
                        <p>输入歌曲名称并搜索</p>
                    </div>
                </div>
                
                <!-- 分页控件 -->
                <div class="pagination" id="pagination" style="display: none;">
                    <button class="pagination-btn" id="prevPageBtn" disabled>
                        <i class="fas fa-chevron-left"></i> 上一页
                    </button>
                    <span class="pagination-info" id="pageInfo">第 1 页</span>
                    <button class="pagination-btn" id="nextPageBtn" disabled>
                        下一页 <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </section>
        </div>
        
        <!-- 播放器固定在右下角 - 缩小版 -->
        <section class="player-section">
            <div class="now-playing" id="nowPlaying">
                <div id="currentCover" class="current-cover">
                    <i class="fas fa-music"></i>
                </div>
                <div class="current-info">
                    <div id="currentTitle" class="current-title">未选择歌曲</div>
                    <div id="currentArtist" class="current-artist">未知艺术家</div>
                </div>
            </div>
            
            <div class="player-controls">
                <div class="progress-container">
                    <span id="currentTime" class="time-display">0:00</span>
                    <div class="progress-bar" id="progressBar">
                        <div class="progress" id="progress"></div>
                    </div>
                    <span id="duration" class="time-display">0:00</span>
                </div>
                
                <div class="control-buttons">
                    <button class="control-btn" id="prevBtn">
                        <i class="fas fa-step-backward"></i>
                    </button>
                    <button class="control-btn play-btn" id="playBtn">
                        <i class="fas fa-play"></i>
                    </button>
                    <button class="control-btn" id="nextBtn">
                        <i class="fas fa-step-forward"></i>
                    </button>
                    <button class="play-mode-btn" id="playModeBtn" title="循环播放">
                        <i class="fas fa-repeat"></i>
                    </button>
                    <div class="volume-container">
                        <button class="volume-btn" id="volumeBtn">
                            <i class="fas fa-volume-up"></i>
                        </button>
                        <div class="volume-panel" id="volumePanel">
                            <div class="volume-slider" id="volumeSlider">
                                <div class="volume-level" id="volumeLevel"></div>
                                <div class="volume-handle" id="volumeHandle"></div>
                            </div>
                        </div>
                    </div>
                    <div class="quality-selector" id="qualitySelector">
                        <button class="quality-btn" id="qualityBtn">
                            <i class="fas fa-music"></i>
                            <span id="qualityText">音质</span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="quality-panel" id="qualityPanel">
                            <div class="quality-option" data-quality="flac">FLAC (无损)</div>
                            <div class="quality-option" data-quality="640k">高品质 (640k)</div>
                            <div class="quality-option active" data-quality="192k">标准 (192k)</div>
                            <div class="quality-option" data-quality="96k">流畅 (96k)</div>
                            <div class="quality-option" data-quality="48k">低音质 (48k)</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- 歌单面板 -->
    <div class="playlist-panel" id="playlistPanel">
        <div class="playlist-header">
            <h2 class="playlist-title">
                <i class="fas fa-list"></i> 我的歌单
            </h2>
            <button class="close-btn" id="closePlaylist">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="playlist-items" id="playlistItems">
            <div class="empty-state">
                <i class="fas fa-music"></i>
                <p>歌单为空，添加一些歌曲吧</p>
            </div>
        </div>
    </div>

    <!-- 遮罩层 -->
    <div class="overlay" id="overlay"></div>

    <script>
        // 全局变量
        let currentAudio = null;
        let currentSong = null;
        let searchResults = [];
        let playlist = JSON.parse(localStorage.getItem('playlist')) || [];
        let currentIndex = -1;
        let isPlaying = false;
        let playMode = 'loop'; // 默认循环播放
        let songDetailsCache = {};
        let currentApi = 'netease'; // 当前使用的API
        let currentQQQuality = '192k'; // 默认QQ音乐音质
        let userScrolledLyrics = false;
        let autoScrollEnabled = true;
        let lyricsScrollAnimation = null;
        let lyricsScrollTimeout = null;
        
        // 分页相关变量
        let currentPage = 1;
        let itemsPerPage = 20;
        let totalResults = 0;
        
        // DOM元素
        const sidebarItems = document.querySelectorAll('.sidebar-item');
        const neteaseSearchForm = document.getElementById('neteaseSearchForm');
        const qqSearchForm = document.getElementById('qqSearchForm');
        const songNameInput = document.getElementById('songName');
        const qqSongNameInput = document.getElementById('qqSongName');
        const resultsContainer = document.getElementById('resultsContainer');
        
        // 全屏播放界面元素
        const playerFullscreen = document.getElementById('playerFullscreen');
        const closePlayer = document.getElementById('closePlayer');
        const playerCover = document.getElementById('playerCover');
        const playerSongTitle = document.getElementById('playerSongTitle');
        const playerSongArtist = document.getElementById('playerSongArtist');
        const playerLyricsContainer = document.getElementById('playerLyricsContainer');
        const playerLyricsContent = document.getElementById('playerLyricsContent');
        const playerCurrentTime = document.getElementById('playerCurrentTime');
        const playerDuration = document.getElementById('playerDuration');
        const playerProgressBar = document.getElementById('playerProgressBar');
        const playerProgress = document.getElementById('playerProgress');
        const playerPlayBtn = document.getElementById('playerPlayBtn');
        const playerPrevBtn = document.getElementById('playerPrevBtn');
        const playerNextBtn = document.getElementById('playerNextBtn');
        const playerPlayModeBtn = document.getElementById('playerPlayModeBtn');
        const playerVolumeBtn = document.getElementById('playerVolumeBtn');
        const playerVolumePanel = document.getElementById('playerVolumePanel');
        const playerVolumeSlider = document.getElementById('playerVolumeSlider');
        const playerVolumeLevel = document.getElementById('playerVolumeLevel');
        const playerVolumeHandle = document.getElementById('playerVolumeHandle');
        const playerQualitySelector = document.getElementById('playerQualitySelector');
        const playerQualityBtn = document.getElementById('playerQualityBtn');
        const playerQualityPanel = document.getElementById('playerQualityPanel');
        const playerQualityText = document.getElementById('playerQualityText');
        
        const currentCover = document.getElementById('currentCover');
        const currentTitle = document.getElementById('currentTitle');
        const currentArtist = document.getElementById('currentArtist');
        const currentTime = document.getElementById('currentTime');
        const duration = document.getElementById('duration');
        const progressBar = document.getElementById('progressBar');
        const progress = document.getElementById('progress');
        const playBtn = document.getElementById('playBtn');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const playModeBtn = document.getElementById('playModeBtn');
        const volumeBtn = document.getElementById('volumeBtn');
        const volumePanel = document.getElementById('volumePanel');
        const volumeSlider = document.getElementById('volumeSlider');
        const volumeLevel = document.getElementById('volumeLevel');
        const volumeHandle = document.getElementById('volumeHandle');
        const qualitySelector = document.getElementById('qualitySelector');
        const qualityBtn = document.getElementById('qualityBtn');
        const qualityPanel = document.getElementById('qualityPanel');
        const qualityText = document.getElementById('qualityText');
        const playlistBtn = document.getElementById('playlistBtn');
        const playlistPanel = document.getElementById('playlistPanel');
        const closePlaylist = document.getElementById('closePlaylist');
        const playlistItems = document.getElementById('playlistItems');
        const overlay = document.getElementById('overlay');
        
        // 分页相关元素
        const pagination = document.getElementById('pagination');
        const prevPageBtn = document.getElementById('prevPageBtn');
        const nextPageBtn = document.getElementById('nextPageBtn');
        const pageInfo = document.getElementById('pageInfo');
        
        // 封面缓存
        const coverCache = new Map();
        
        // 事件监听
        // 侧边栏切换
        sidebarItems.forEach(item => {
            item.addEventListener('click', function() {
                sidebarItems.forEach(i => i.classList.remove('active'));
                this.classList.add('active');
                
                const api = this.getAttribute('data-api');
                switchApi(api);
            });
        });
        
        // 切换API
        function switchApi(api) {
            currentApi = api;
            
            if (api === 'netease') {
                neteaseSearchForm.style.display = 'flex';
                qqSearchForm.style.display = 'none';
            } else if (api === 'qq') {
                neteaseSearchForm.style.display = 'none';
                qqSearchForm.style.display = 'flex';
            }
            
            // 清空搜索结果
            resultsContainer.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-search"></i>
                    <p>输入歌曲名称并搜索</p>
                </div>
            `;
            pagination.style.display = 'none';
        }
        
        // 搜索歌曲 - 网易云音乐
        neteaseSearchForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const songName = songNameInput.value.trim();
            
            if (!songName) {
                alert('请输入歌曲名称');
                return;
            }
            
            // 重置分页
            currentPage = 1;
            
            // 显示加载状态
            resultsContainer.innerHTML = `
                <div class="loading">
                    <i class="fas fa-spinner"></i>
                    <span>正在搜索歌曲...</span>
                </div>
            `;
            
            try {
                const searchUrl = `https://api.jkyai.top/API/hqyyid.php?name=${encodeURIComponent(songName)}&type=wy&page=${currentPage}&limit=${itemsPerPage}`;
                const response = await fetch(searchUrl);
                const data = await response.json();
                
                if (data.code === 1 && data.data) {
                    searchResults = Array.isArray(data.data) ? data.data : [data.data];
                    totalResults = searchResults.length;
                    displaySearchResults();
                    updatePagination();
                    
                    // 并行加载所有歌曲的详细信息
                    loadAllSongDetails();
                } else {
                    resultsContainer.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-search"></i>
                            <p>未找到相关歌曲</p>
                        </div>
                    `;
                    pagination.style.display = 'none';
                }
            } catch (error) {
                console.error('搜索歌曲出错:', error);
                resultsContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>搜索失败，请重试</p>
                    </div>
                `;
                pagination.style.display = 'none';
            }
        });
        
        // 搜索歌曲 - QQ音乐
        qqSearchForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const songName = qqSongNameInput.value.trim();
            
            if (!songName) {
                alert('请输入歌曲名称');
                return;
            }
            
            // 显示加载状态
            resultsContainer.innerHTML = `
                <div class="loading">
                    <i class="fas fa-spinner"></i>
                    <span>正在搜索歌曲...</span>
                </div>
            `;
            
            try {
                const searchUrl = `https://api.jkyai.top/API/qqmusic.php?msg=${encodeURIComponent(songName)}`;
                const response = await fetch(searchUrl);
                const data = await response.json();
                
                if (data.code === 200 && data.data && data.data.songs) {
                    searchResults = data.data.songs;
                    totalResults = searchResults.length;
                    displaySearchResults();
                    pagination.style.display = 'none';
                } else {
                    resultsContainer.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-search"></i>
                            <p>未找到相关歌曲</p>
                        </div>
                    `;
                    pagination.style.display = 'none';
                }
            } catch (error) {
                console.error('搜索歌曲出错:', error);
                resultsContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>搜索失败，请重试</p>
                    </div>
                `;
                pagination.style.display = 'none';
            }
        });
        
        // 更新分页显示
        function updatePagination() {
            if (totalResults === 0) {
                pagination.style.display = 'none';
                return;
            }
            
            pagination.style.display = 'flex';
            pageInfo.textContent = `第 ${currentPage} 页`;
            
            // 更新上一页按钮状态
            prevPageBtn.disabled = currentPage <= 1;
            
            // 更新下一页按钮状态
            nextPageBtn.disabled = searchResults.length < itemsPerPage;
        }
        
        // 上一页
        prevPageBtn.addEventListener('click', async function() {
            if (currentPage <= 1) return;
            
            currentPage--;
            await performSearch();
        });
        
        // 下一页
        nextPageBtn.addEventListener('click', async function() {
            currentPage++;
            await performSearch();
        });
        
        // 执行搜索
        async function performSearch() {
            const songName = songNameInput.value.trim();
            
            if (!songName) return;
            
            // 显示加载状态
            resultsContainer.innerHTML = `
                <div class="loading">
                    <i class="fas fa-spinner"></i>
                    <span>正在搜索歌曲...</span>
                </div>
            `;
            
            try {
                const searchUrl = `https://api.jkyai.top/API/hqyyid.php?name=${encodeURIComponent(songName)}&type=wy&page=${currentPage}&limit=${itemsPerPage}`;
                const response = await fetch(searchUrl);
                const data = await response.json();
                
                if (data.code === 1 && data.data) {
                    searchResults = Array.isArray(data.data) ? data.data : [data.data];
                    totalResults = searchResults.length;
                    displaySearchResults();
                    updatePagination();
                    
                    // 并行加载所有歌曲的详细信息
                    loadAllSongDetails();
                } else {
                    resultsContainer.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-search"></i>
                            <p>未找到相关歌曲</p>
                        </div>
                    `;
                    pagination.style.display = 'none';
                }
            } catch (error) {
                console.error('搜索歌曲出错:', error);
                resultsContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>搜索失败，请重试</p>
                    </div>
                `;
                pagination.style.display = 'none';
            }
        }
        
        // 并行加载所有歌曲的详细信息
        async function loadAllSongDetails() {
            const promises = searchResults.map(async (song, index) => {
                // 如果已经缓存了详情，直接使用
                if (songDetailsCache[song.id]) {
                    updateSongCover(index, songDetailsCache[song.id]);
                    return;
                }
                
                try {
                    // 获取歌曲详细信息
                    const detailUrl = `https://api.jkyai.top/API/yyjhss.php?id=${song.id}&type=wy`;
                    const response = await fetch(detailUrl);
                    const data = await response.json();
                    
                    if (data.code === 1 && data.data) {
                        const songDetail = data.data;
                        // 缓存歌曲详情
                        songDetailsCache[song.id] = songDetail;
                        // 更新歌曲封面
                        updateSongCover(index, songDetail);
                    }
                } catch (error) {
                    console.error(`获取歌曲 ${song.name} 详情出错:`, error);
                }
            });
            
            // 并行执行所有请求
            await Promise.allSettled(promises);
        }
        
        // 更新歌曲封面
        function updateSongCover(index, songDetail) {
            const songCard = document.querySelector(`.song-card[data-index="${index}"]`);
            if (!songCard) return;
            
            const coverContainer = songCard.querySelector('.song-cover');
            if (!coverContainer) return;
            
            // 移除加载动画
            coverContainer.classList.remove('cover-loading');
            
            // 使用与播放卡片相同的封面获取方式
            if (songDetail.pic) {
                const cleanPicUrl = songDetail.pic.replace(/\\\//g, '/').replace(/([^:]\/)\/+/g, '$1');
                
                // 检查缓存中是否已有此封面
                if (coverCache.has(cleanPicUrl)) {
                    coverContainer.innerHTML = `
                        <img src="${cleanPicUrl}" alt="歌曲封面" style="width:100%;height:100%;border-radius:10px;object-fit:cover;" onerror="handleCoverError(this)">
                        <div class="play-overlay">
                            <i class="fas fa-play"></i>
                        </div>
                    `;
                    return;
                }
                
                // 创建图片预加载
                const img = new Image();
                img.onload = function() {
                    coverContainer.innerHTML = `
                        <img src="${cleanPicUrl}" alt="歌曲封面" style="width:100%;height:100%;border-radius:10px;object-fit:cover;" onerror="handleCoverError(this)">
                        <div class="play-overlay">
                            <i class="fas fa-play"></i>
                        </div>
                    `;
                    // 添加到缓存
                    coverCache.set(cleanPicUrl, true);
                };
                img.onerror = function() {
                    // 图片加载失败，使用默认图标
                    coverContainer.innerHTML = `
                        <i class="fas fa-music"></i>
                        <div class="play-overlay">
                            <i class="fas fa-play"></i>
                        </div>
                    `;
                };
                img.src = cleanPicUrl;
            } else {
                // 如果没有封面，保持默认图标
                coverContainer.innerHTML = `
                    <i class="fas fa-music"></i>
                    <div class="play-overlay">
                        <i class="fas fa-play"></i>
                    </div>
                `;
            }
        }
        
        // 显示搜索结果
        function displaySearchResults() {
            if (searchResults.length === 0) {
                resultsContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-search"></i>
                        <p>未找到相关歌曲</p>
                    </div>
                `;
                return;
            }
            
            const resultsHTML = searchResults.map((song, index) => {
                // 处理不同API返回的数据结构
                const songName = song.name || '未知歌曲';
                const artist = song.artist || '未知艺术家';
                const album = song.album || '';
                const coverUrl = song.cover || (songDetailsCache[song.id] ? songDetailsCache[song.id].pic : null);
                
                return `
                <div class="song-card" data-index="${index}">
                    <div class="song-cover cover-loading">
                        ${coverUrl ? `<img src="${coverUrl}" alt="歌曲封面" style="width:100%;height:100%;border-radius:10px;object-fit:cover;" onerror="handleCoverError(this)">` : '<i class="fas fa-music"></i>'}
                        <div class="play-overlay">
                            <i class="fas fa-play"></i>
                        </div>
                    </div>
                    <div class="song-info">
                        <div class="song-title">${songName}</div>
                        <div class="song-artist">${artist}</div>
                        ${album ? `<div class="song-album">${album}</div>` : ''}
                    </div>
                    <div class="song-actions">
                        <button class="action-btn add-to-playlist" title="添加到歌单">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                </div>
                `;
            }).join('');
            
            resultsContainer.innerHTML = resultsHTML;
            
            // 添加点击事件
            document.querySelectorAll('.song-card').forEach(card => {
                card.addEventListener('click', (e) => {
                    if (!e.target.closest('.song-actions')) {
                        const index = parseInt(card.getAttribute('data-index'));
                        playSongFromSearch(index);
                    }
                });
            });
            
            // 添加添加到歌单事件
            document.querySelectorAll('.add-to-playlist').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const index = parseInt(btn.closest('.song-card').getAttribute('data-index'));
                    addToPlaylist(index);
                });
            });
        }
        
        // 添加到歌单
        function addToPlaylist(index) {
            const song = searchResults[index];
            
            // 检查是否已在歌单中
            const exists = playlist.some(item => {
                if (currentApi === 'netease') {
                    return item.id === song.id;
                } else if (currentApi === 'qq') {
                    return item.id === song.id;
                }
                return false;
            });
            
            if (exists) {
                alert('该歌曲已在歌单中');
                return;
            }
            
            playlist.push(song);
            localStorage.setItem('playlist', JSON.stringify(playlist));
            updatePlaylistDisplay();
            alert('已添加到歌单');
        }
        
        // 更新歌单显示
        function updatePlaylistDisplay() {
            if (playlist.length === 0) {
                playlistItems.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-music"></i>
                        <p>歌单为空，添加一些歌曲吧</p>
                    </div>
                `;
                return;
            }
            
            const playlistHTML = playlist.map((song, index) => {
                // 处理不同API返回的数据结构
                const songName = song.name || '未知歌曲';
                const artist = song.artist || '未知艺术家';
                const coverUrl = song.cover || (songDetailsCache[song.id] ? songDetailsCache[song.id].pic : null);
                
                return `
                <div class="playlist-item" data-index="${index}">
                    <div class="playlist-item-cover">
                        ${coverUrl ? `<img src="${coverUrl}" alt="歌曲封面" style="width:100%;height:100%;border-radius:8px;object-fit:cover;" onerror="handlePlaylistCoverError(this)">` : '<i class="fas fa-music"></i>'}
                    </div>
                    <div class="playlist-item-info">
                        <div class="playlist-item-title">${songName}</div>
                        <div class="playlist-item-artist">${artist}</div>
                    </div>
                    <div class="playlist-item-actions">
                        <button class="playlist-remove-btn" title="从歌单移除">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                `;
            }).join('');
            
            playlistItems.innerHTML = playlistHTML;
            
            // 添加点击事件
            document.querySelectorAll('.playlist-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    if (!e.target.closest('.playlist-item-actions')) {
                        const index = parseInt(item.getAttribute('data-index'));
                        playSongFromPlaylist(index);
                    }
                });
            });
            
            // 添加移除事件
            document.querySelectorAll('.playlist-remove-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const index = parseInt(btn.closest('.playlist-item').getAttribute('data-index'));
                    removeFromPlaylist(index);
                });
            });
        }
        
        // 从歌单移除
        function removeFromPlaylist(index) {
            playlist.splice(index, 1);
            localStorage.setItem('playlist', JSON.stringify(playlist));
            updatePlaylistDisplay();
            
            // 如果移除的是当前播放的歌曲
            if (currentIndex === index) {
                if (currentAudio) {
                    currentAudio.pause();
                    currentAudio = null;
                }
                currentSong = null;
                currentIndex = -1;
                isPlaying = false;
                
                // 重置播放器
                currentTitle.textContent = '未选择歌曲';
                currentArtist.textContent = '未知艺术家';
                currentCover.innerHTML = '<i class="fas fa-music"></i>';
                playBtn.innerHTML = '<i class="fas fa-play"></i>';
                playerPlayBtn.innerHTML = '<i class="fas fa-play"></i>';
                currentTime.textContent = '0:00';
                playerCurrentTime.textContent = '0:00';
                duration.textContent = '0:00';
                playerDuration.textContent = '0:00';
                progress.style.width = '0%';
                playerProgress.style.width = '0%';
            } else if (currentIndex > index) {
                currentIndex--;
            }
        }
        
        // 从搜索结果播放歌曲
        async function playSongFromSearch(index) {
            if (index < 0 || index >= searchResults.length) return;
            
            const song = searchResults[index];
            
            // 检查是否已在歌单中
            let playlistIndex = playlist.findIndex(item => {
                if (currentApi === 'netease') {
                    return item.id === song.id;
                } else if (currentApi === 'qq') {
                    return item.id === song.id;
                }
                return false;
            });
            
            // 如果不在歌单中，则添加到歌单
            if (playlistIndex === -1) {
                playlist.push(song);
                localStorage.setItem('playlist', JSON.stringify(playlist));
                updatePlaylistDisplay();
                playlistIndex = playlist.length - 1;
            }
            
            // 播放歌单中的歌曲
            playSongFromPlaylist(playlistIndex);
        }
        
        // 从歌单播放歌曲
        async function playSongFromPlaylist(index) {
            if (index < 0 || index >= playlist.length) return;
            
            currentIndex = index;
            currentSong = playlist[index];
            
            // 更新当前播放信息
            currentTitle.textContent = currentSong.name || '未知歌曲';
            currentArtist.textContent = currentSong.artist || '未知艺术家';
            
            try {
                let audioUrl;
                let coverUrl;
                let lyrics = null;
                
                if (currentApi === 'netease') {
                    // 使用缓存的歌曲详情或重新获取
                    let songDetail;
                    if (songDetailsCache[currentSong.id]) {
                        songDetail = songDetailsCache[currentSong.id];
                    } else {
                        const detailUrl = `https://api.jkyai.top/API/yyjhss.php?id=${currentSong.id}&type=wy`;
                        const response = await fetch(detailUrl);
                        const data = await response.json();
                        
                        if (data.code === 1 && data.data) {
                            songDetail = data.data;
                            songDetailsCache[currentSong.id] = songDetail;
                        } else {
                            throw new Error('获取歌曲信息失败');
                        }
                    }
                    
                    audioUrl = songDetail.url;
                    coverUrl = songDetail.pic;
                    lyrics = songDetail.lrc;
                } else if (currentApi === 'qq') {
                    // 获取QQ音乐播放链接
                    const detailUrl = `https://api.jkyai.top/API/qqmusic.php?msg=${encodeURIComponent(currentSong.name)}&n=${currentSong.number}`;
                    const response = await fetch(detailUrl);
                    const data = await response.json();
                    
                    if (data.code === 200 && data.data) {
                        // 根据选择的音质获取对应的URL
                        const selectedFormat = data.data.formats.find(format => format.quality === currentQQQuality);
                        if (selectedFormat) {
                            audioUrl = selectedFormat.url;
                        } else {
                            // 如果没有找到对应音质，使用推荐链接
                            audioUrl = data.data.recommended_url;
                        }
                        coverUrl = data.data.cover;
                    } else {
                        throw new Error('获取歌曲信息失败');
                    }
                }
                
                // 更新右下角播放卡片封面
                if (coverUrl) {
                    const cleanPicUrl = coverUrl.replace(/\\\//g, '/').replace(/([^:]\/)\/+/g, '$1');
                    currentCover.innerHTML = `<img src="${cleanPicUrl}" alt="歌曲封面" style="width:100%;height:100%;border-radius:8px;object-fit:cover;" onerror="handleCoverError(this)">`;
                } else {
                    currentCover.innerHTML = '<i class="fas fa-music"></i>';
                }
                
                // 更新全屏播放界面
                updateFullscreenPlayer(coverUrl, lyrics);
                
                // 显示全屏播放界面
                showFullscreenPlayer();
                
                // 播放音频
                if (audioUrl) {
                    playAudio(audioUrl);
                }
            } catch (error) {
                console.error('获取歌曲详情出错:', error);
                alert('获取歌曲详情失败，请重试');
            }
        }
        
        // 显示全屏播放界面
        function showFullscreenPlayer() {
            playerFullscreen.classList.add('show');
        }
        
        // 隐藏全屏播放界面
        function hideFullscreenPlayer() {
            playerFullscreen.classList.remove('show');
        }
        
        // 更新全屏播放界面
        function updateFullscreenPlayer(coverUrl, lyrics) {
            // 更新封面
            if (coverUrl) {
                const cleanPicUrl = coverUrl.replace(/\\\//g, '/').replace(/([^:]\/)\/+/g, '$1');
                playerCover.innerHTML = `<img src="${cleanPicUrl}" alt="歌曲封面" style="width:100%;height:100%;border-radius:20px;object-fit:cover;" onerror="handlePlayerCoverError()">`;
            } else {
                playerCover.innerHTML = '<i class="fas fa-music"></i>';
            }
            
            // 更新歌曲信息
            playerSongTitle.textContent = currentSong.name || '未知歌曲';
            playerSongArtist.textContent = currentSong.artist || '未知艺术家';
            
            // 更新歌词
            if (lyrics) {
                displayPlayerLyrics(lyrics);
            } else {
                playerLyricsContent.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-file-alt"></i>
                        <p>暂无歌词</p>
                    </div>
                `;
            }
            
            // 重置滚动状态
            userScrolledLyrics = false;
            autoScrollEnabled = true;
            
            // 确保歌词容器滚动到顶部
            playerLyricsContainer.scrollTop = 0;
            
            // 添加歌词容器滚动监听
            playerLyricsContainer.addEventListener('scroll', handleLyricsScroll);
        }
        
        // 处理歌词滚动
        function handleLyricsScroll() {
            // 用户手动滚动歌词时，禁用自动滚动
            if (!userScrolledLyrics) {
                userScrolledLyrics = true;
                autoScrollEnabled = false;
            }
            
            // 清除之前的计时器
            if (lyricsScrollTimeout) {
                clearTimeout(lyricsScrollTimeout);
            }
            
            // 设置3秒后恢复自动滚动
            lyricsScrollTimeout = setTimeout(() => {
                userScrolledLyrics = false;
                autoScrollEnabled = true;
            }, 3000);
        }
        
        // 处理全屏播放界面封面加载错误
        function handlePlayerCoverError() {
            playerCover.innerHTML = '<i class="fas fa-music"></i>';
        }
        
        // 处理封面加载错误
        function handleCoverError(img) {
            img.outerHTML = '<i class="fas fa-music"></i>';
        }
        
        // 处理歌单封面加载错误
        function handlePlaylistCoverError(img) {
            img.outerHTML = '<i class="fas fa-music"></i>';
        }
        
        // 在全屏播放界面显示歌词
        function displayPlayerLyrics(lrcText) {
            const lines = lrcText.split('\n');
            const lyricsHTML = lines.map(line => {
                const timeMatch = line.match(/\[(\d+):(\d+)\.(\d+)\]/);
                if (timeMatch) {
                    const minutes = parseInt(timeMatch[1]);
                    const seconds = parseInt(timeMatch[2]);
                    const milliseconds = parseInt(timeMatch[3]);
                    const timeInSeconds = minutes * 60 + seconds + milliseconds / 100;
                    const text = line.replace(/\[.*?\]/g, '').trim();
                    
                    if (text) {
                        return `<div class="player-lyric-line" data-time="${timeInSeconds}">${text}</div>`;
                    }
                }
                return '';
            }).filter(html => html).join('');
            
            playerLyricsContent.innerHTML = lyricsHTML || `
                <div class="empty-state">
                    <i class="fas fa-file-alt"></i>
                    <p>歌词格式不支持</p>
                </div>
            `;
        }
        
        // 平滑滚动函数
        function smoothScrollTo(element, targetTop, duration = 500) {
            if (lyricsScrollAnimation) {
                cancelAnimationFrame(lyricsScrollAnimation);
            }
            
            const startTop = element.scrollTop;
            const distance = targetTop - startTop;
            const startTime = performance.now();
            
            function scrollStep(timestamp) {
                const elapsed = timestamp - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                // 使用缓动函数使滚动更平滑
                const easeProgress = easeOutCubic(progress);
                element.scrollTop = startTop + (distance * easeProgress);
                
                if (progress < 1) {
                    lyricsScrollAnimation = requestAnimationFrame(scrollStep);
                }
            }
            
            lyricsScrollAnimation = requestAnimationFrame(scrollStep);
        }
        
        // 缓动函数
        function easeOutCubic(t) {
            return 1 - Math.pow(1 - t, 3);
        }
        
        // 更新全屏播放界面歌词高亮和平滑滚动
        function updatePlayerLyricsHighlight(currentTime) {
            const lyricLines = document.querySelectorAll('.player-lyric-line');
            let activeLine = null;
            
            for (let i = lyricLines.length - 1; i >= 0; i--) {
                const line = lyricLines[i];
                const lineTime = parseFloat(line.getAttribute('data-time'));
                
                if (currentTime >= lineTime) {
                    activeLine = line;
                    break;
                }
            }
            
            // 移除所有高亮
            lyricLines.forEach(line => line.classList.remove('active'));
            
            // 高亮当前行
            if (activeLine) {
                activeLine.classList.add('active');
                
                // 只有当自动滚动启用时才滚动歌词
                if (autoScrollEnabled) {
                    // 计算滚动位置，使当前歌词行在歌词容器中间
                    const container = playerLyricsContainer;
                    const containerHeight = container.clientHeight;
                    const lineHeight = activeLine.offsetHeight;
                    const lineOffset = activeLine.offsetTop;
                    
                    const targetScrollTop = lineOffset - (containerHeight / 2) + (lineHeight / 2);
                    
                    // 使用平滑滚动
                    smoothScrollTo(container, targetScrollTop, 500);
                }
            }
        }
        
        // 播放音频
        function playAudio(url) {
            // 停止当前播放的音频
            if (currentAudio) {
                currentAudio.pause();
                currentAudio = null;
            }
            
            // 移除转义字符和重复斜杠
            const cleanUrl = url.replace(/\\\//g, '/').replace(/([^:]\/)\/+/g, '$1');
            
            currentAudio = new Audio(cleanUrl);
            currentAudio.volume = 0.7;
            
            // 更新播放按钮
            playBtn.innerHTML = '<i class="fas fa-pause"></i>';
            playerPlayBtn.innerHTML = '<i class="fas fa-pause"></i>';
            isPlaying = true;
            
            // 音频加载完成
            currentAudio.addEventListener('loadedmetadata', () => {
                duration.textContent = formatTime(currentAudio.duration);
                playerDuration.textContent = formatTime(currentAudio.duration);
            });
            
            // 播放进度更新
            currentAudio.addEventListener('timeupdate', () => {
                if (currentAudio.duration) {
                    const percent = (currentAudio.currentTime / currentAudio.duration) * 100;
                    progress.style.width = `${percent}%`;
                    playerProgress.style.width = `${percent}%`;
                    currentTime.textContent = formatTime(currentAudio.currentTime);
                    playerCurrentTime.textContent = formatTime(currentAudio.currentTime);
                    
                    // 更新歌词高亮
                    updatePlayerLyricsHighlight(currentAudio.currentTime);
                }
            });
            
            // 播放结束
            currentAudio.addEventListener('ended', () => {
                if (playMode === 'loop') {
                    // 循环播放模式下，播放下一首
                    playNext();
                }
                // 单次播放模式下，不做任何事，直接结束
            });
            
            // 开始播放
            currentAudio.play().catch(error => {
                console.error('播放失败:', error);
                alert('播放失败，请重试');
            });
        }
        
        // 切换播放/暂停
        function togglePlay() {
            if (!currentAudio) return;
            
            if (isPlaying) {
                currentAudio.pause();
                playBtn.innerHTML = '<i class="fas fa-play"></i>';
                playerPlayBtn.innerHTML = '<i class="fas fa-play"></i>';
            } else {
                currentAudio.play();
                playBtn.innerHTML = '<i class="fas fa-pause"></i>';
                playerPlayBtn.innerHTML = '<i class="fas fa-pause"></i>';
            }
            
            isPlaying = !isPlaying;
        }
        
        // 播放上一首
        function playPrevious() {
            if (playlist.length === 0) return;
            
            let newIndex;
            if (playMode === 'random') {
                newIndex = Math.floor(Math.random() * playlist.length);
            } else {
                newIndex = currentIndex - 1;
                if (newIndex < 0) {
                    newIndex = playlist.length - 1;
                }
            }
            
            playSongFromPlaylist(newIndex);
        }
        
        // 播放下一首
        function playNext() {
            if (playlist.length === 0) return;
            
            let newIndex;
            if (playMode === 'random') {
                newIndex = Math.floor(Math.random() * playlist.length);
            } else {
                newIndex = currentIndex + 1;
                if (newIndex >= playlist.length) {
                    newIndex = 0;
                }
            }
            
            playSongFromPlaylist(newIndex);
        }
        
        // 切换播放模式
        function togglePlayMode() {
            const modes = ['loop', 'once'];
            const modeIcons = ['repeat', 'play'];
            const modeTitles = ['循环播放', '单次播放'];
            
            const currentModeIndex = modes.indexOf(playMode);
            const nextModeIndex = (currentModeIndex + 1) % modes.length;
            
            playMode = modes[nextModeIndex];
            playModeBtn.innerHTML = `<i class="fas fa-${modeIcons[nextModeIndex]}"></i>`;
            playModeBtn.title = modeTitles[nextModeIndex];
            playerPlayModeBtn.innerHTML = `<i class="fas fa-${modeIcons[nextModeIndex]}"></i>`;
            playerPlayModeBtn.title = modeTitles[nextModeIndex];
        }
        
        // 格式化时间 (秒 -> mm:ss)
        function formatTime(seconds) {
            if (isNaN(seconds)) return '0:00';
            
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
        }
        
        // 初始化音量控制
        function initVolumeControl() {
            let volume = 0.7;
            
            // 更新音量显示
            function updateVolumeDisplay() {
                volumeLevel.style.height = `${volume * 100}%`;
                volumeHandle.style.bottom = `${volume * 100}%`;
                playerVolumeLevel.style.height = `${volume * 100}%`;
                playerVolumeHandle.style.bottom = `${volume * 100}%`;
                
                if (currentAudio) {
                    currentAudio.volume = volume;
                }
                
                // 更新音量图标
                const volumeIcon = volume < 0.01 ? 'volume-mute' : volume < 0.5 ? 'volume-down' : 'volume-up';
                volumeBtn.innerHTML = `<i class="fas fa-${volumeIcon}"></i>`;
                playerVolumeBtn.innerHTML = `<i class="fas fa-${volumeIcon}"></i>`;
            }
            
            // 设置音量
            function setVolume(newVolume) {
                volume = Math.max(0, Math.min(1, newVolume));
                updateVolumeDisplay();
            }
            
            // 音量滑块点击事件
            volumeSlider.addEventListener('click', (e) => {
                const rect = volumeSlider.getBoundingClientRect();
                const volumePercent = 1 - (e.clientY - rect.top) / rect.height;
                setVolume(volumePercent);
            });
            
            playerVolumeSlider.addEventListener('click', (e) => {
                const rect = playerVolumeSlider.getBoundingClientRect();
                const volumePercent = 1 - (e.clientY - rect.top) / rect.height;
                setVolume(volumePercent);
            });
            
            // 音量滑块拖动事件
            function initVolumeDrag(slider, level, handle) {
                let isDragging = false;
                
                function startDrag(e) {
                    isDragging = true;
                    slider.classList.add('dragging');
                    document.addEventListener('mousemove', onDrag);
                    document.addEventListener('mouseup', stopDrag);
                    e.preventDefault();
                }
                
                function onDrag(e) {
                    if (!isDragging) return;
                    
                    const rect = slider.getBoundingClientRect();
                    let volumePercent = 1 - (e.clientY - rect.top) / rect.height;
                    volumePercent = Math.max(0, Math.min(1, volumePercent));
                    setVolume(volumePercent);
                }
                
                function stopDrag() {
                    isDragging = false;
                    slider.classList.remove('dragging');
                    document.removeEventListener('mousemove', onDrag);
                    document.removeEventListener('mouseup', stopDrag);
                }
                
                slider.addEventListener('mousedown', startDrag);
                handle.addEventListener('mousedown', startDrag);
            }
            
            initVolumeDrag(volumeSlider, volumeLevel, volumeHandle);
            initVolumeDrag(playerVolumeSlider, playerVolumeLevel, playerVolumeHandle);
            
            // 音量按钮点击事件
            volumeBtn.addEventListener('click', () => {
                volumePanel.classList.toggle('show');
            });
            
            playerVolumeBtn.addEventListener('click', () => {
                playerVolumePanel.classList.toggle('show');
            });
            
            // 点击其他地方关闭音量面板
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.volume-container')) {
                    volumePanel.classList.remove('show');
                }
                if (!e.target.closest('.player-volume-container')) {
                    playerVolumePanel.classList.remove('show');
                }
            });
            
            updateVolumeDisplay();
        }
        
        // 初始化进度条控制
        function initProgressControl() {
            let isDraggingProgress = false;
            
            function startProgressDrag(e) {
                if (!currentAudio) return;
                
                isDraggingProgress = true;
                progressBar.classList.add('dragging');
                playerProgressBar.classList.add('dragging');
                document.addEventListener('mousemove', onProgressDrag);
                document.addEventListener('mouseup', stopProgressDrag);
                e.preventDefault();
                
                // 立即更新进度
                onProgressDrag(e);
            }
            
            function onProgressDrag(e) {
                if (!isDraggingProgress || !currentAudio) return;
                
                const progressBarRect = progressBar.getBoundingClientRect();
                const clickPosition = (e.clientX - progressBarRect.left) / progressBarRect.width;
                const newTime = clickPosition * currentAudio.duration;
                
                currentAudio.currentTime = newTime;
            }
            
            function stopProgressDrag() {
                isDraggingProgress = false;
                progressBar.classList.remove('dragging');
                playerProgressBar.classList.remove('dragging');
                document.removeEventListener('mousemove', onProgressDrag);
                document.removeEventListener('mouseup', stopProgressDrag);
            }
            
            // 进度条点击事件
            progressBar.addEventListener('click', (e) => {
                if (!currentAudio) return;
                
                const progressBarRect = progressBar.getBoundingClientRect();
                const clickPosition = (e.clientX - progressBarRect.left) / progressBarRect.width;
                const newTime = clickPosition * currentAudio.duration;
                
                currentAudio.currentTime = newTime;
            });
            
            playerProgressBar.addEventListener('click', (e) => {
                if (!currentAudio) return;
                
                const progressBarRect = playerProgressBar.getBoundingClientRect();
                const clickPosition = (e.clientX - progressBarRect.left) / progressBarRect.width;
                const newTime = clickPosition * currentAudio.duration;
                
                currentAudio.currentTime = newTime;
            });
            
            // 进度条拖动事件
            progressBar.addEventListener('mousedown', startProgressDrag);
            playerProgressBar.addEventListener('mousedown', startProgressDrag);
        }
        
        // 初始化音质选择器
        function initQualitySelector() {
            // 更新音质显示
            function updateQualityDisplay() {
                const qualityTexts = {
                    'flac': 'FLAC',
                    '640k': '高品质',
                    '192k': '标准',
                    '96k': '流畅',
                    '48k': '低音质'
                };
                
                qualityText.textContent = qualityTexts[currentQQQuality] || '音质';
                playerQualityText.textContent = qualityTexts[currentQQQuality] || '音质';
                
                // 更新选项高亮
                document.querySelectorAll('.quality-option').forEach(option => {
                    option.classList.remove('active');
                    if (option.getAttribute('data-quality') === currentQQQuality) {
                        option.classList.add('active');
                    }
                });
            }
            
            // 设置音质
            function setQuality(quality) {
                currentQQQuality = quality;
                updateQualityDisplay();
                
                // 如果当前播放的是QQ音乐歌曲，重新获取播放链接
                if (currentApi === 'qq' && currentSong) {
                    playSongFromPlaylist(currentIndex);
                }
            }
            
            // 音质选项点击事件
            document.querySelectorAll('.quality-option').forEach(option => {
                option.addEventListener('click', () => {
                    const quality = option.getAttribute('data-quality');
                    setQuality(quality);
                    
                    // 关闭音质面板
                    qualityPanel.classList.remove('show');
                    playerQualityPanel.classList.remove('show');
                });
            });
            
            // 音质按钮点击事件
            qualityBtn.addEventListener('click', () => {
                qualityPanel.classList.toggle('show');
            });
            
            playerQualityBtn.addEventListener('click', () => {
                playerQualityPanel.classList.toggle('show');
            });
            
            // 点击其他地方关闭音质面板
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.quality-selector')) {
                    qualityPanel.classList.remove('show');
                }
                if (!e.target.closest('.player-quality-selector')) {
                    playerQualityPanel.classList.remove('show');
                }
            });
            
            updateQualityDisplay();
        }
        
        // 初始化歌单面板
        function initPlaylistPanel() {
            // 点击右下角播放卡片显示全屏播放界面
            document.getElementById('nowPlaying').addEventListener('click', function() {
                if (currentSong) {
                    showFullscreenPlayer();
                }
            });
            
            closePlaylist.addEventListener('click', () => {
                playlistPanel.classList.remove('show');
                overlay.classList.remove('show');
            });
            
            overlay.addEventListener('click', () => {
                playlistPanel.classList.remove('show');
                overlay.classList.remove('show');
            });
        }
        
        // 初始化事件监听
        function initEventListeners() {
            // 播放控制
            playBtn.addEventListener('click', togglePlay);
            playerPlayBtn.addEventListener('click', togglePlay);
            
            // 上一首/下一首
            prevBtn.addEventListener('click', playPrevious);
            playerPrevBtn.addEventListener('click', playPrevious);
            nextBtn.addEventListener('click', playNext);
            playerNextBtn.addEventListener('click', playNext);
            
            // 播放模式
            playModeBtn.addEventListener('click', togglePlayMode);
            playerPlayModeBtn.addEventListener('click', togglePlayMode);
            
            // 关闭全屏播放界面
            closePlayer.addEventListener('click', hideFullscreenPlayer);
            
            // 初始化音量控制
            initVolumeControl();
            
            // 初始化进度条控制
            initProgressControl();
            
            // 初始化音质选择器
            initQualitySelector();
            
            // 初始化歌单面板
            initPlaylistPanel();
            
            // 初始化歌单显示
            updatePlaylistDisplay();
        }
        
        // 初始化应用
        function initApp() {
            initEventListeners();
        }
        
        // 启动应用
        initApp();
    </script>
</body>
</html>
